<!DOCTYPE html>
<html lang="ru">
<head>
    <title>RPG</title>
    <script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
    <link href="/css/my.css" rel="stylesheet">
    <meta charset="UTF-8">
</head>
<body onload="update_table(0)">
<h1>RPG admin panel</h1>
<h2>Accounts list:</h2>
Count per page:
<select id="count_per_page" onchange="update_table(0)">
    <option value="3">3</option>
    <option value="10">10</option>
    <option value="15">15</option>
    <option value="20">20</option>
</select>
<table id="player-table" class="table-base">
    <thead class="table-head">
    <th>#</th>
    <th>Name</th>
    <th>Title</th>
    <th>Race</th>
    <th>Profession</th>
    <th>Level</th>
    <th>Birthday</th>
    <th>Banned</th>
    <th>Edit</th>
    <th>Delete</th>
    </thead>
    <tbody class="table-body">
    </tbody>
</table>
Pages:
<div id="buttons"></div>
<script>
    function update_table(pageNumber) {
        $("tr:has(td)").remove();
        let url = '/rest/players?';
        let selectPageNum = $("#count_per_page").val();
        url = url.concat("pageSize=").concat(selectPageNum)
            .concat("&pageNumber=").concat(pageNumber);


        $.get(url, function (response) {
            let selectPageNum = $("#count_per_page").val();
            $.each(response, function (i, item) {
                $('<tr>').html("<td>"
                    + item.id + "</td><td>"
                    + item.name + "</td><td>"
                    + item.title + "</td><td>"
                    + item.race + "</td><td>"
                    + item.profession + "</td><td>"
                    + item.level + "</td><td>"
                    + new Date(item.birthday).toLocaleDateString() + "</td><td>"
                    + item.banned + "</td><td>"
                    + "<button id='button_edit_"+item.id+"' onclick='editPlayer(" + item.id + "," + selectPageNum + ")'>"
                    +"<img src='/img/edit.png' alt='edit' title='edit'>"
                    +"</button></td><td>"
                    +"<button id='button_delete_"+item.id+"' onclick='deletePlayer(" + item.id + "," + selectPageNum + ")'>"
                    + "<img src='/img/delete.png'  alt='delete' title='delete'>"
                    + "</button></td>"
                ).appendTo('#player-table')
            })
        });
        setAllPlayerInBase();

        let identifire = "#pagin_button_" + pageNumber;
        $(identifire).addClass('button-color');

    }

    function getTotalPlayers() {
        let url = '/rest/players/count';
        let res = 0;
        $.ajax({
                url: url,
                async: false,
                success: function (response) {
                    res = parseInt(response);
                }
            }
        );
        return res;
    }

    function setAllPlayerInBase() {
        let selectPageNum = $("#count_per_page").val();
        let numOfPage = getTotalPlayers();
        let numOfButton = Math.ceil(numOfPage / selectPageNum);
        $("button.page-btn-style").remove();
        for (let i = 0; i < numOfButton; i++) {
            let buttonTxt = '<button>' + (i + 1) + '</button>';
            let btn = $(buttonTxt)
                .attr('id', "pagin_button_" + i)
                .attr('onclick', "update_table(" + i + ")")
                .addClass('page-btn-style')
            $('#buttons').append(btn);
        }
    }

    function editPlayer(PlayerId, pageId) {
        /*
        let url = '/rest/players/';
        url = url.concat(PlayerId);
        $.ajax({
                type: "edit",
                url: url,
                success: function (response) {
                    update_table(pageId);
                }
            }
        )
        */

    }

    function deletePlayer(PlayerId, pageId) {
        let url = '/rest/players/';
        url = url.concat(PlayerId);
        $.ajax({
                type: "delete",
                url: url,
                success: function () {
                    update_table(getCurrentPage());
                }
            }
        )
    }

    function getCurrentPage() {
        let currentPage = 0;
        $('div button').each(function () {
            if ($(this).hasClass('button-color')) {
                currentPage = $(this).text();
                return false;
            }
            ;
        });
        return parseInt(currentPage - 1);
    }

</script>

</body>
</html>







