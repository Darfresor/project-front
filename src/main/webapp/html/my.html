<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>RPG</title>
    <script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
    <link href="/css/my.css" rel="stylesheet">
</head>
<body onload="update_table(0)">
<h1>RPG admin panel</h1>
<h2>Accounts list:</h2>
Count per page:
<select id="count_per_page" onchange="update_table(0)">
    <option value="3">3</option>
    <option value="10">10</option>
    <option value="15">15</option>
    <option value="20">20</option>
</select>
<table id="player-table" class="table-base">
    <thead class="table-head">
    <th>#</th>
    <th>Name</th>
    <th>Title</th>
    <th>Race</th>
    <th>Profession</th>
    <th>Level</th>
    <th>Birthday</th>
    <th>Banned</th>
    <th>Edit</th>
    <th>Delete</th>
    </thead>
    <tbody class="table-body">
    </tbody>
</table>
Pages:
<div id='buttons'></div>
<hr style="width: 100%; border: 1px solid black;">
<h2>Create new Account:</h2>
<div id='div_create'>
    <label for='input_name_create'>Name:</label>
    <input type="text" id='input_name_create' value='' required size="12" maxlength="12">
    <br>
    <label for='input_title_create'>Title:</label>
    <input type="text" id='input_title_create' value='' required size="30" maxlength="30">
    <br>
    <label for='select_race_create'>Race:</label>
    <select id='select_race_create'>"
        <option value='HUMAN'>HUMAN</option>
        <option value='ELF'>ELF</option>
        <option value='GIANT'>GIANT</option>
        <option value='ORC'>ORC</option>
        <option value='TROLL'>TROLL</option>
        <option value='HOBBIT'>HOBBIT</option>
    </select>
    <br>
    <label for='select_profession_create'>Profession:</label>
    <select id='select_profession_create'>
        <option value='WARRIOR'>WARRIOR</option>
        <option value='ROGUE'>ROGUE</option>
        <option value='SORCERER'>SORCERER</option>
        <option value='CLERIC'>CLERIC</option>
        <option value='PALADIN'>PALADIN</option>
        <option value='NAZGUL'>NAZGUL</option>
        <option value='WARLOCK'>WARLOCK</option>
        <option value='DRUID'>DRUID</option>
    </select>
    <br>
    <label for='input_level_create'>Level:</label>
    <input type="number" id='input_level_create' value='' min="0" max="100">
    <br><label for='input_birthday_create'>Birthday:</label>
    <input type='date' id='input_birthday_create' value='' min="2000-01-01" max="3000-01-01">
    <br>
    <label for='select_banned_create'>Banned:</label>
    <select id='select_banned_create'>
        <option value='true'>true</option>
        <option value='false'>false</option>
    </select>
    <br><br>
    <button onclick='createNewPlayer()'>Save</button>
</div>


<script>
    function update_table(pageNumber) {
        $("tr:has(td)").remove();
        let url = '/rest/players?';
        let selectPageNum = $("#count_per_page").val();
        url = url.concat("pageSize=").concat(selectPageNum)
            .concat("&pageNumber=").concat(pageNumber);


        $.get(url, function (response) {
            let selectPageNum = $("#count_per_page").val();
            $.each(response, function (i, item) {
                $('<tr>').html("<td>"
                    + item.id + "</td><td>"
                    + item.name + "</td><td>"
                    + item.title + "</td><td>"
                    + item.race + "</td><td>"
                    + item.profession + "</td><td>"
                    + item.level + "</td><td>"
                    + new Date(item.birthday).toLocaleDateString() + "</td><td>"
                    + item.banned + "</td><td>"
                    + "<button id='button_edit_" + item.id + "' onclick='editPlayer(" + item.id + "," + selectPageNum + ")'>"
                    + "<img src='/img/edit.png' alt='edit' title='edit'>"
                    + "</button></td><td>"
                    + "<button id='button_delete_" + item.id + "' onclick='deletePlayer(" + item.id + "," + selectPageNum + ")'>"
                    + "<img src='/img/delete.png'  alt='delete' title='delete'>"
                    + "</button></td>"
                ).appendTo('#player-table')
            })
        });
        setAllPlayerInBase();

        let identifire = "#pagin_button_" + pageNumber;
        $(identifire).addClass('button-color');

    }

    function getTotalPlayers() {
        let url = '/rest/players/count';
        let res = 0;
        $.ajax({
                url: url,
                async: false,
                success: function (response) {
                    res = parseInt(response);
                }
            }
        );
        return res;
    }

    function setAllPlayerInBase() {
        let selectPageNum = $("#count_per_page").val();
        let numOfPage = getTotalPlayers();
        let numOfButton = Math.ceil(numOfPage / selectPageNum);
        $("button.page-btn-style").remove();
        for (let i = 0; i < numOfButton; i++) {
            let buttonTxt = '<button>' + (i + 1) + '</button>';
            let btn = $(buttonTxt)
                .attr('id', "pagin_button_" + i)
                .attr('onclick', "update_table(" + i + ")")
                .addClass('page-btn-style')
            $('#buttons').append(btn);
        }
    }

    function editPlayer(PlayerId, pageId) {
        let buttonDelete = "#button_delete_" + PlayerId;
        let buttonEdit = "#button_edit_" + PlayerId;
        let imgDelete = "#button_delete_" + PlayerId + " img";
        let imgEdit = "#button_edit_" + PlayerId + " img";
        let savePlayer = "savePlayer(" + PlayerId + "," + pageId + ")";
        $(buttonDelete).remove();
        $(imgDelete).remove();
        $(imgEdit).attr('src', "/img/save.png");
        $(buttonEdit).attr('onclick', savePlayer);


        let current_tr_element = $(buttonEdit).parent().parent();

        let child_tr = current_tr_element.children();
        let td_name = child_tr[1];
        td_name.innerHTML = "<input id='input_name_" + PlayerId + "' value = '" + td_name.innerHTML + "'>";
        let td_title = child_tr[2];
        td_title.innerHTML = "<input id='input_title_" + PlayerId + "' value = '" + td_title.innerHTML + "'>";
        let td_race = child_tr[3];
        let race_id = "#select_race_" + PlayerId;
        let current_race = td_race.innerHTML;
        td_race.innerHTML = getDropDownRaceHtml(PlayerId);
        $(race_id).val(current_race).change();

        let td_profession = child_tr[4];
        let profession_id = "#select_profession_" + PlayerId;
        let current_profession = td_profession.innerHTML;
        td_profession.innerHTML = getDropDownProfessionHtml(PlayerId);
        $(profession_id).val(current_profession).change();

        let td_banned = child_tr[7];
        let banned_id = "#select_banned_" + PlayerId;
        let current_banned = td_banned.innerHTML;
        td_banned.innerHTML = getDropDownBannedHtml(PlayerId);
        $(banned_id).val(current_banned).change();

    }

    function getDropDownRaceHtml(PlayerId) {
        return "<select id='select_race_" + PlayerId + "'>"
            + "<option value='HUMAN'>HUMAN</option>"
            + "<option value='ELF'>ELF</option>"
            + "<option value='GIANT'>GIANT</option>"
            + "<option value='ORC'>ORC</option>"
            + "<option value='TROLL'>TROLL</option>"
            + "<option value='HOBBIT'>HOBBIT</option>"
            + "</select>";
    }

    function getDropDownProfessionHtml(PlayerId) {
        return "<select id='select_profession_" + PlayerId + "'>"
            + "<option value='WARRIOR'>WARRIOR</option>"
            + "<option value='ROGUE'>ROGUE</option>"
            + "<option value='SORCERER'>SORCERER</option>"
            + "<option value='CLERIC'>CLERIC</option>"
            + "<option value='PALADIN'>PALADIN</option>"
            + "<option value='NAZGUL'>NAZGUL</option>"
            + "<option value='WARLOCK'>WARLOCK</option>"
            + "<option value='DRUID'>DRUID</option>"
            + "</select>";
    }

    function getDropDownBannedHtml(PlayerId) {
        return "<select id='select_banned_" + PlayerId + "'>"
            + "<option value='true'>true</option>"
            + "<option value='false'>false</option>"
            + "</select>";
    }

    function savePlayer(PlayerId, pageId) {
        let name_id = "#input_name_" + PlayerId;
        let name = $(name_id).val();

        let title_id = "#input_title_" + PlayerId;
        let title = $(title_id).val();

        let race_id = "#select_race_" + PlayerId;
        let race = $(race_id).val();

        let profession_id = "#select_profession_" + PlayerId;
        let profession = $(profession_id).val();

        let banned_id = "#select_banned_" + PlayerId;
        let banned = $(banned_id).val();

        let player = {
            name: name,
            title: title,
            race: race,
            profession: profession,
            banned: banned
        };

        let jsonString = JSON.stringify(player);

        let url = '/rest/players/';
        url = url.concat(PlayerId);
        $.ajax({
                type: 'POST',
                url: url,
                dataType: 'json',
                contentType: 'application/json',
                data: jsonString,
                success: function () {
                    update_table(getCurrentPage());
                }
            }
        )

    }

    function createNewPlayer() {
        let name_id = "#input_name_create";
        let name = $(name_id).val();

        let title_id = "#input_title_create";
        let title = $(title_id).val();

        let race_id = "#select_race_create";
        let race = $(race_id).val();

        let profession_id = "#select_profession_create";
        let profession = $(profession_id).val();

        let level_id = "#input_level_create";
        let level = $(level_id).val();

        let birthday_id = "#input_birthday_create";
        let birthday = $(birthday_id).val();

        let banned_id = "#select_banned_create";
        let banned = $(banned_id).val();

        let player = {
            name: name,
            title: title,
            race: race,
            profession: profession,
            level: level,
            birthday: new Date(birthday).getTime(),
            banned: banned
        };

        let jsonString = JSON.stringify(player);
        let url = '/rest/players';
        $.ajax({
                type: 'POST',
                url: url,
                dataType: 'json',
                contentType: 'application/json;charset=UTF-8',
                data: jsonString,
                success: function () {
                    clearCreateInput();
                    update_table(getCurrentPage());
                }
            }
        )

    }

    function clearCreateInput() {
        let name_id = "#input_name_create";
        $(name_id).val("").change();
        let title_id = "#input_title_create";
        $(title_id).val("").change();

        let level_id = "#input_level_create";
        $(level_id).val("").change();

    }


    function deletePlayer(PlayerId, pageId) {
        let url = '/rest/players/';
        url = url.concat(PlayerId);
        $.ajax({
                type: 'DELETE',
                url: url,
                success: function () {
                    update_table(getCurrentPage());
                }
            }
        )
    }

    function getCurrentPage() {
        let currentPage = 0;
        $('div button').each(function () {
            if ($(this).hasClass('button-color')) {
                currentPage = $(this).text();
                return false;
            }
        });
        return parseInt(currentPage - 1);
    }

</script>

</body>
</html>







